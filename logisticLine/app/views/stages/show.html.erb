<div class = "container">
  <h1> Informacion de la etapa </h1>
  <div class = "row">
    <div class = "col-md-12">
      <div class="panel panel-default">
        <div class="panel-heading clearfix">
          <h3 class="panel-title pull-left" style="padding-top: 7.5px;"><%= @stage.name %></h3>
          <% if can? :edit, State %>
            <div class="btn-group pull-right">
              <td>
                <%= link_to  "www", class: "btn btn-primary" do %>
                    <i class="glyphicon glyphicon-pencil"></i> Editar
                <%end %>
              </td>
              <td><%= link_to 'X', "www", class: "btn btn-danger",method: :delete, data: { confirm: 'Are you sure?' } %></td>
            </div>
          <% end %>
        </div>
        <div class="panel-body">
          <div class = "well">
           <p>
             <%= @stage.description %>
           </p>
          </div>
          <div class = "row">
            <div class = "col-md-4">
              <p>
                <strong>Numero actores: </strong> <%= @stage.n_actors %>
              </p>
              <p>
                <strong>Numero procesos:</strong> <%= @stage.n_process %>
              </p>
            </div>

            <div class = "col-md-4">
              <p>
                <strong>Numero actores: </strong> 5
              </p>
              <p>
                <strong>Numero procesos:</strong> 5
              </p>
            </div>

            <div class = "col-md-4">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target=<%="#states_flow_modal_0"%>>Ver flujo</button>
              <%= render :partial => 'states/show_states_flow_modal', :locals => {:stage => @stage, :modal_counter => 0} %>
            </div>

          </div>

        </div>
      </div>
    </div>

  </div>
  <h1> Estados </h1>
  <div class = "row">
    <% modal_counter = 1 %>
    <% @stage.states.each do |state| %>
        <div class = "col-md-4">
          <div class="panel panel-default ">
            <div class="panel-heading state-alert-<%= state.alert %>">
              <h3 class="panel-title"><%= state.name %></h3>
            </div>
            <div class = "row">
              <div class="col-md-8 col-md-offset-2 ">
                <h3>Estado actual </h3>
                <div class="panel panel-default">
                  <div style="text-align: center" class= "panel-body state-alert-<%= state.alert %>" >
                    <% if state.sub_state %>
                        <%= state.state_s(state.sub_state.to_s) %>
                    <% else %>
                      No definido
                    <% end %>
                  </div>
                </div>
              </div>
            </div>
            <div class="panel-body state-alert-<%= state.alert %>" >
              <p>
                <strong>Numero actores: </strong> <%= state.n_actors %>
              </p>
              <p>
                <strong>Numero procesos:</strong> <%= state.n_sub_process %>
              </p>
            </div>
            <div class="panel-footer state-alert-<%= state.alert %>">
              <button type="button" class="btn btn-info" data-toggle="modal" data-target=<%="#sub_states_modal_#{modal_counter}"%>>Ver flujo</button>
              <% if can? :edit, State %>
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target=<%="#state_alert_edit_modal_#{modal_counter}"%>>Alertas</button>
                  <button type="button" class="btn btn-primary" data-toggle="modal" data-target=<%="#next_state_modal_#{modal_counter}"%>>Siguente estado</button>
              <% end %>


              <%= render :partial => 'sub_state_modal', :locals => {:state => state, :modal_counter => modal_counter} %>
              <%= render :partial => 'state_alert_modal', :locals => {:state => state, :modal_counter => modal_counter} %>
              <%= render :partial => 'states/next_state_modal', :locals => {:state => state, :modal_counter => modal_counter} %>

            </div>

          </div>
        </div>
        <% modal_counter += 1 %>
    <%end%>
  </div>
</div>
